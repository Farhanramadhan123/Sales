// File: prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// =========================================
// 1. MODEL USER (SALES / ADMIN)
// =========================================
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("SALES") // SALES, ADMIN
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  simulations Simulation[]
}

// =========================================
// 2. MODEL RATE ASURANSI (PREMI)
// =========================================
model InsuranceRate {
  id        Int     @id @default(autoincrement())
  
  category  String  // e.g., "PASSENGER", "COMMERCIAL_USED"
  tenor     Int     // Tahun
  label     String  // e.g., "5 THN COMPH"
  
  minPrice  Float   
  maxPrice  Float   
  rate      Float   // Desimal (0.0125)

  @@index([category, tenor, minPrice, maxPrice])
}

// =========================================
// 3. MODEL RATE BUNGA (INTEREST)
// =========================================
model InterestRate {
  id           Int     @id @default(autoincrement())
  
  category     String  // "PASSENGER", "COMMERCIAL"
  paymentType  String  // "ADDB", "ADDM"
  
  star         Int?    // 1-7
  tenor        Int     // Bulan (12, 24...)
  
  rate         Float   // Bunga Flat per Tahun (desimal)

  @@index([category, paymentType, star, tenor])
}

// =========================================
// 4. MODEL CONFIG STAR (Optional)
// =========================================
model StarConfig {
  id          Int     @id @default(autoincrement())
  starLevel   Int     @unique 
  minDp       Float   
  description String?
}

// =========================================
// 5. MODEL HISTORY SIMULASI (LENGKAP)
// =========================================
model Simulation {
  id              Int      @id @default(autoincrement())
  
  // --- Data Nasabah ---
  borrowerName    String
  coBorrowerName  String?
  salesName       String?
  status          String   @default("TODO") // TODO, PROGRES, DONE, REJECT

  // --- Data Unit & Pilihan ---
  unitName        String
  nopol           String?
  category        String   // "PASSENGER", "COMMERCIAL"
  subCategory     String?  // "TRUCK", "BUS"
  isLoadingUnit   Boolean  @default(false)
  
  // --- Parameter Kredit (Input) ---
  vehiclePrice    Float    // Harga OTR
  dpPercent       Float    // DP Input (%)
  tenor           Int      // Bulan
  paymentType     String   // "ADDB", "ADDM"
  adminFee        Float 
  insuranceLabel  String?

  // --- Hasil Hitungan (Snapshot Lengkap) ---
  dpAmount        Float    // Nominal DP Murni
  monthlyPayment  Float    // Angsuran per Bulan
  totalFirstPay   Float    // TDP (Total Down Payment)
  
  interestRate    Float?   // Rate Bunga (%)
  insuranceRate   Float?   // Rate Asuransi (%)
  insuranceAmount Float?   // Nominal Asuransi
  
  // Field Tambahan agar Data Lengkap
  principalPure   Float?   // Pokok Hutang Murni (PH Murni)
  policyFee       Float?   // Biaya Polis (AR)
  totalAR         Float?   // Total AR (PH Murni + Asuransi + Polis)
  totalInterest   Float?   // Total Bunga (Rupiah)
  totalLoan       Float?   // Jumlah Hutang / PH (Total AR + Bunga)
  policyFeeTDP    Float?   // Biaya Polis di TDP
  firstInstallment Float?  // Angsuran Pertama (khusus ADDM)
  nilaiAP         Float?   // Nilai AP (OTR - TDP)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // --- Relasi ---
  userId          Int?
  user            User?    @relation(fields: [userId], references: [id])
}